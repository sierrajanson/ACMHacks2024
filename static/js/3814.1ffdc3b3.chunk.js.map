{"version":3,"file":"static/js/3814.1ffdc3b3.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/portal/support/layersLoader.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{parse as t}from\"../../layers/support/arcgisLayerUrl.js\";import{fetchFeatureService as r}from\"../../layers/support/fetchService.js\";import{LayerLoadContext as a}from\"../../layers/support/LayerLoadContext.js\";import{populateGroupLayer as o}from\"../../layers/support/layersCreator.js\";import{layerLookupMap as n}from\"../../layers/support/lazyLayerLoader.js\";import s from\"../Portal.js\";import{createForItemRead as i}from\"./jsonContext.js\";import{getFirstLayerOrTable as l,preprocessFSItemData as c,populateSceneServiceItemData as u,getNumLayersAndTables as p,createSublayerData as y,instanceTypeToLayerType as f,getSublayersByLayerType as m,layerTypeToLayerModuleType as d}from\"./loadUtils.js\";import{hasTypeKeyword as w}from\"./portalItemUtils.js\";import{loadStyleRenderer as h}from\"../../renderers/support/styleUtils.js\";import{fetchArcGISServiceJSON as I}from\"../../support/requestPresets.js\";async function g(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),b(e),e.validateItem&&e.validateItem(r),L(e,t)}function b(t){const r=t.instance.portalItem;if(!r?.type||!t.supportedTypes.includes(r.type))throw new e(\"portal:invalid-layer-item-type\",\"Invalid layer item type '${type}', expected '${expectedType}'\",{type:r?.type,expectedType:t.supportedTypes.join(\", \")})}async function L(e,t){const r=e.instance,o=r.portalItem;if(!o)return;const{url:n,title:s}=o,l=i(o,\"portal-item\");if(\"group\"===r.type)return S(r,l,e);n&&\"media\"!==r.type&&r.read({url:n},l);const c=new a,u=await M(e,c,t);return u&&r.read(u,l),r.resourceReferences={portalItem:o,paths:l.readResourcePaths??[]},\"subtype-group\"!==r.type&&r.read({title:s},l),h(r,l)}async function S(t,r,a){const o=t.portalItem;if(!t.sourceIsPortalItem)return;const{title:n,type:s}=o;if(\"Group Layer\"===s){if(!w(o,\"Map\"))throw new e(\"portal:invalid-layer-item-typekeyword\",\"'Group Layer' item without 'Map' type keyword is not supported\");return T(t)}return t.read({title:n},r),v(t,a)}async function T(e){const t=e.portalItem,r=await t.fetchData(\"json\");if(!r)return;const a=i(t,\"web-map\");e.read(r,a),await o(e,r,{context:a}),e.resourceReferences={portalItem:t,paths:a.readResourcePaths??[]}}async function v(t,r){let o;const{portalItem:n}=t;if(!n)return;const s=n.type,i=r.layerModuleTypeMap;switch(s){case\"Feature Service\":case\"Feature Collection\":o=i.FeatureLayer;break;case\"Stream Service\":o=i.StreamLayer;break;case\"Scene Service\":o=i.SceneLayer;break;default:throw new e(\"portal:unsupported-item-type-as-group\",`The item type '${s}' is not supported as a 'IGroupLayer'`)}const y=new a;let[f,m]=await Promise.all([o(),M(r,y)]),d=()=>f;if(\"Feature Service\"===s){const e=l(m)?.customParameters;m=n.url?await c(m,n.url,y):{},d=await E(m,i)||d;const r=await k(n.url,{customParameters:e,loadContext:y});return await F(t,d,m,r)}return\"Scene Service\"===s&&n.url&&(m=await u(n,m,y)),p(m)>0?await F(t,d,m):await j(t,d)}async function j(e,t){const{portalItem:r}=e;if(!r?.url)return;const a=await I(r.url);a&&F(e,t,{layers:a.layers?.map(y),tables:a.tables?.map(y)})}async function F(e,t,r,a){let o=r.layers||[];const s=r.tables||[];if(\"Feature Collection\"===e.portalItem?.type?(o.forEach(((e,t)=>{e.id=t,\"Table\"===e?.layerDefinition?.type&&s.push(e)})),o=o.filter((e=>\"Table\"!==e?.layerDefinition?.type))):(o.reverse(),s.reverse()),o.forEach((o=>{const n=a?.(o);if(n||!a){const a=P(e,t(o),r,o,n);e.add(a)}})),s.length){const t=await n.FeatureLayer();s.forEach((o=>{const n=a?.(o);if(n||!a){const a=P(e,t,r,o,n);e.tables.add(a)}}))}}function P(e,t,r,a,o){const n=e.portalItem,i={portalItem:n.clone(),layerId:a.id};null!=a.url&&(i.url=a.url);const l=new t(i);if(\"sourceJSON\"in l&&(l.sourceJSON=o),\"subtype-group\"!==l.type&&\"catalog\"!==l.type&&(l.sublayerTitleMode=\"service-name\"),\"Feature Collection\"===n.type){const e={origin:\"portal-item\",portal:n.portal||s.getDefault()};l.read(a,e);const t=r.showLegend;null!=t&&l.read({showLegend:t},e)}return l}async function M(e,t,r){if(!1===e.supportsData)return;const a=e.instance,o=a.portalItem;if(!o)return;let n=null;try{n=await o.fetchData(\"json\",r)}catch(s){}if(D(a)){let e=null;const r=await x(o,n,t);if((n?.layers||n?.tables)&&r>0){if(null==a.layerId){const e=f(a.type),t=e?m(n,e)[0]:l(n);t&&(a.layerId=t.id)}e=C(n,a),\"OrientedImageryLayer\"===e?.layerType&&\"oriented-imagery\"===a.type&&a.supportedSourceTypes.add(\"Feature Layer\"),e&&null!=n.showLegend&&(e.showLegend=n.showLegend)}return r>1&&\"sublayerTitleMode\"in a&&\"service-name\"!==a.sublayerTitleMode&&(a.sublayerTitleMode=\"item-title-and-service-name\"),e}return n}async function x(e,r,a){if(r?.layers&&r?.tables)return p(r);const o=t(e.url);if(!o)return 1;const n=await a.fetchServiceMetadata(o.url.path,{customParameters:l(r)?.customParameters}).catch((()=>null));return(r?.layers?.length??n?.layers?.length??0)+(r?.tables?.length??n?.tables?.length??0)}function C(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&G(a,t)?a:null}function D(e){return\"stream\"!==e.type&&\"layerId\"in e}function G(e,t){const r=\"layerType\"in e&&e.layerType,{type:a}=t;return!(\"feature\"===a&&r&&\"ArcGISFeatureLayer\"!==e.layerType||\"catalog\"===a&&!r||\"oriented-imagery\"===a&&!r||\"subtype-group\"===a&&!r)}async function k(e,t){const{layersJSON:a}=await r(e,t);if(!a)return null;const o=[...a.layers,...a.tables];return e=>o.find((t=>t.id===e.id))}async function E(e,t){const{layers:r}=e;if(!r?.length)return;const a=new Set,o=[];for(const{layerType:i}of r){const e=i??\"ArcGISFeatureLayer\";if(a.has(e))continue;a.add(e);const r=t[d(e)];o.push(r())}const n=await Promise.all(o),s=new Map;return Array.from(a).forEach(((e,t)=>{s.set(e,n[t])})),({layerType:e})=>{const t=e??\"ArcGISFeatureLayer\";return s.get(t)}}export{g as load};\n"],"names":["async","g","e","t","r","instance","portalItem","id","load","type","supportedTypes","includes","expectedType","join","b","validateItem","o","url","n","title","s","l","i","a","sourceIsPortalItem","w","fetchData","read","context","resourceReferences","paths","readResourcePaths","T","layerModuleTypeMap","FeatureLayer","StreamLayer","SceneLayer","y","f","m","Promise","all","M","d","customParameters","c","layers","length","Set","layerType","has","add","push","Map","Array","from","forEach","set","_ref","get","E","layersJSON","tables","find","k","loadContext","F","u","p","I","map","j","v","S","h","L","layerDefinition","filter","reverse","P","clone","layerId","sourceJSON","sublayerTitleMode","origin","portal","getDefault","showLegend","supportsData","D","fetchServiceMetadata","path","catch","x","G","C","supportedSourceTypes"],"sourceRoot":""}